---
title: "ESM 244 Lab Lab 2"
author: "Katelin Seeto"
date: "1/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set

library(tidyverse)
library(janitor)
library(palmerpenguins)
library(here)

# For PCA
library(ggfortify)

# For ggplot customization
library(readxl)
library(gghighlight)
library(lubridate)
library(plotly)

# For compound figures 
library(patchwork)
```

## Part 1: PCA with penguins data

First some wrangling! Select columns we need, remove n/a since isn't useful when looking at multivariate space, scale data to make sure no variable is over weighted in principle components just due to the units it is measured in. 

Notice that body mass is in grams and values are in 1000's compared with bill length in mm with values in 10's

Notes:  
* `ends_with()` is a helper function to select all variables ending with a certain string  
* `drop_na()` drops all rows with n/a values, can write variables inside () to specifify which columns to drop n/a from  
* `scale()` scales the data  
* `prcomp()` runs principle components and changes your df into a list 
* `autoplot()` uses ggplot2 to draw a particular plot for an object of a particular class in a single command. For ex, for PCA data type it will assume you want a PCA biplot

```{r}
penguins_pca <- penguins %>% 
  select(body_mass_g, ends_with("_mm")) %>% 
  drop_na() %>% 
  scale() %>% 
  prcomp()

penguins_pca$rotation # brings up the loadings for each of the 4 variables along that principle component

# Create biplot with autoplot(), doesn't have info about variable loadings, or label penguin spp!
autoplot(penguins_pca)

# Create new plot which contains info we can update aesthetics by, like spp and other variables
penguin_complete <- penguins %>% 
  drop_na(body_mass_g, ends_with("_mm"))
# Includes PCA data, and the observations used to make that PCA 
# Observations used to create PCA and data used for aesthetics MUST align!
autoplot(penguins_pca,
         data = penguin_complete, 
         colour = 'species',
         loadings = TRUE, 
         loadings.label = TRUE)+
  theme_minimal()


```

